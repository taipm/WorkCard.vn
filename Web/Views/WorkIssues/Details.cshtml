@using CafeT.Objects
@using System.Globalization
@using Web.Models
@using Web.ModelViews
@model Web.Models.WorkIssue
@{
    ViewBag.Title = "Details - "  + Model.Title;
}
<div class="row">
    <div class="col-sm-8">
        <div class="bg-picture card-box">
            <div class="profile-info-name">
                <img src="assets/images/profile.jpg"
                     class="img-thumbnail" alt="profile-image">
                <div class="profile-info-detail">
                    <h4 class="m-t-0 m-b-0">
                        @if (Model.Repeat != Web.Models.RepeatType.None)
                        {
                            <span class="label label-info">@Model.Repeat</span>
                        }
                        @Model.Title
                        <span class="label label-danger">@Model.Status</span>
                    </h4>
                    <p>
                        Work on: 
                        @if (@Model.Start.HasValue)
                        {
                            @Model.Start.Value.ToShortDateString()
                            @Html.Raw("-")
                        }
                        @Model.End.Value.ToShortDateString()
                        <span class="label label-danger">@Model.TimeToDo (phút)</span>
                    </p>
                    <p class="text-muted m-b-20"><i>@Model.CreatedBy</i></p>
                    <p>
                        @Html.Raw(Model.Content)
                    </p>
                    <div class="button-list m-t-20">
                        <button type="button" class="btn btn-facebook btn-sm waves-effect waves-light">
                            <i class="fa fa-facebook"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-twitter waves-effect waves-light">
                            <i class="fa fa-twitter"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-linkedin waves-effect waves-light">
                            <i class="fa fa-linkedin"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-dribbble waves-effect waves-light">
                            <i class="fa fa-dribbble"></i>
                        </button>
                    </div>
                    <p>
                        @Html.Partial("_IssueMenuForDetail", Model)
                    </p>
                    <p>
                        Có <span class=" badge badge-info">@Model.Content.ToWords().Count()</span>  từ
                        @Html.Raw(" | ")
                        Có <span class=" badge badge-info">@Model.Content.GetEmails().Count()</span>  emails
                        @Html.Raw(" | ")
                        Có <span class=" badge badge-info">@Model.Content.GetTimes().Count()</span>  mốc thời gian
                    </p>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
        <!--/ meta -->
        @Html.Partial("_AddQuestion", new Question() { IssueId = Model.Id })
        
        @Html.Partial("_Questions", (IEnumerable<Question>)ViewBag.Questions)
    </div>
    <div class="col-sm-4">
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            <h4 class="header-title m-t-0 m-b-30">Issue members</h4>
            <ul class="list-group m-b-0 user-list">
                @if (Model.Content.GetEmails() != null && Model.Content.GetEmails().Count() > 0)
                {
                    foreach (string _member in Model.Content.GetEmails())
                    {
                        string _cssId = _member.Replace("@", "_").Replace(".", "_");
                        <li id="@_cssId" class="list-group-item">
                                <div class="avatar">
                                    <img src="assets/images/users/avatar-2.jpg" alt="">
                                </div>
                                <div class="user-desc">
                                    <span class="name">@Html.Raw(_member)</span>
                                    <span class="desc">
                                        @Ajax.ActionLink("Add", "AddContact", "Contacts", new { email = _member },
                                            new AjaxOptions
                                            {
                                                UpdateTargetId = @_cssId,
                                                HttpMethod = "Post",
                                                InsertionMode = InsertionMode.Replace
                                            }, 
                                            new { @class = "user-list-item" })
                                    </span>
                                </div>
                        </li>
                    }
                }
            </ul>
        </div>
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            <h4 class="header-title m-t-0 m-b-30"><i class="zmdi zmdi-notifications-none m-r-5"></i> Tham khảo</h4>
            <ul class="list-group m-b-0 user-list">
                @if (ViewBag.ReferItems != null)
                {
                    foreach (var _member in (IEnumerable<WorkIssue>)ViewBag.ReferItems)
                    {
                        <li class="list-group-item">
                            <a href="#" class="user-list-item">
                                <div class="avatar">
                                    <img src="assets/images/users/avatar-2.jpg" alt="">
                                </div>
                                <div class="user-desc">
                                    <span class="name">@Html.Raw(_member.Title)</span>
                                    <span class="desc">Member</span>
                                </div>
                            </a>
                        </li>
                    }
                }
            </ul>
        </div>
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            <h4 class="header-title m-t-0 m-b-30"><i class="zmdi zmdi-notifications-none m-r-5"></i> My Reminders</h4>
            <ul class="list-group m-b-0 user-list">
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-primary"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Meet Manager</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-success"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Project Discussion</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-pink"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Meet Manager</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-muted"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Project Discussion</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-danger"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Meet Manager</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            <h4 class="header-title m-t-0 m-b-30"><i class="zmdi zmdi-notifications-none m-r-5"></i> Links</h4>
            <ul class="list-group m-b-0 user-list">
                    @if (ViewBag.Urls != null)
                    {
                        foreach (string _link in (IEnumerable<string>)ViewBag.Urls)
                        {
                            string _linkId = _link.Replace("/", "_").Replace(".", "_").Replace(":","_");
                            <li id="@_linkId" class="list-group-item">
                                <div class="avatar">
                                    <img src="assets/images/users/avatar-2.jpg" alt="">
                                </div>
                                <div class="user-desc">
                                    <span class="name">@Html.Raw(_link.ToHtmlLink())</span>
                                    <br />
                                    <span class="desc">
                                        @Ajax.ActionLink("Add", "AddUrl", "Urls", new { url = _link },
                                                            new AjaxOptions
                                                            {
                                                                UpdateTargetId = _linkId,
                                                                HttpMethod = "Post",
                                                                InsertionMode = InsertionMode.Replace
                                                            },
                                                            new { @class = "user-list-item" })
                                    </span>
                                </div>
                            </li>
                        }
                    }
                </ul>
        </div>
    </div>
</div>
<!-- Right Sidebar -->
<div class="side-bar right-bar">
    <a href="javascript:void(0);" class="right-bar-toggle">
        <i class="zmdi zmdi-close-circle-o"></i>
    </a>
    <h4 class="">Notifications</h4>
    <div class="notification-list nicescroll">
        <ul class="list-group list-no-border user-list">
            <li class="list-group-item">
                <a href="#" class="user-list-item">
                    <div class="avatar">
                        <img src="assets/images/users/avatar-2.jpg" alt="">
                    </div>
                    <div class="user-desc">
                        <span class="name">Michael Zenaty</span>
                        <span class="desc">There are new settings available</span>
                        <span class="time">2 hours ago</span>
                    </div>
                </a>
            </li>
            <li class="list-group-item">
                <a href="#" class="user-list-item">
                    <div class="icon bg-info">
                        <i class="zmdi zmdi-account"></i>
                    </div>
                    <div class="user-desc">
                        <span class="name">New Signup</span>
                        <span class="desc">There are new settings available</span>
                        <span class="time">5 hours ago</span>
                    </div>
                </a>
            </li>
            <li class="list-group-item">
                <a href="#" class="user-list-item">
                    <div class="icon bg-pink">
                        <i class="zmdi zmdi-comment"></i>
                    </div>
                    <div class="user-desc">
                        <span class="name">New Message received</span>
                        <span class="desc">There are new settings available</span>
                        <span class="time">1 day ago</span>
                    </div>
                </a>
            </li>
            <li class="list-group-item active">
                <a href="#" class="user-list-item">
                    <div class="avatar">
                        <img src="assets/images/users/avatar-3.jpg" alt="">
                    </div>
                    <div class="user-desc">
                        <span class="name">James Anderson</span>
                        <span class="desc">There are new settings available</span>
                        <span class="time">2 days ago</span>
                    </div>
                </a>
            </li>
            <li class="list-group-item active">
                <a href="#" class="user-list-item">
                    <div class="icon bg-warning">
                        <i class="zmdi zmdi-settings"></i>
                    </div>
                    <div class="user-desc">
                        <span class="name">Settings</span>
                        <span class="desc">There are new settings available</span>
                        <span class="time">1 day ago</span>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</div>
<!-- /Right-bar -->
       
        <div class="row">
            <div class="col-md-8">
                
                @if (Model.Content.HasCloudEmbedFiles())
                {
                <h4>
                    Files:
                </h4>
                <p>
                    @foreach (string youtubeLink in Model.Content.GetEmbedCloudFiles())
                    {
                    @Html.Raw(youtubeLink)
                    <hr />
                    }
                </p>
                }
                <p>

                </p>
                <p>
                    @if (Model.Tags != null && Model.Tags.Count > 0)
                    {
                    <h4>Tags: </h4>
                    foreach (var _tag in Model.Tags)
                    {
                    @Html.Raw(_tag + "; ")
                    }
                    }
                </p>
                <div id="Update"></div>
                
            </div>
            <div class="col-md-4">
                Sentences: @Model.Content.GetSentences().Count()
                <br />
                @if (Model.Content.HasYouTubeLink())
                {
                    foreach (string youtubeLink in Model.Content.GetYouTubeUrls())
                    {
                        <div class="container">
                            <div class="sixteen columns">
                                <div class="embed-container">
                                    @{
                                    YouTubeView _youTube = new YouTubeView(youtubeLink);
                                    @Html.Raw(_youTube.EmbedUrl);
                                    }
                                </div>
                            </div>
                        </div>
                        }
                    }
                    <br />
                    @if (Model.Content.GetTimes() != null && Model.Content.GetTimes().Length > 0)
                    {
                        <h4>Times: </h4>
                        foreach (var _time in Model.Content.GetTimes())
                        {
                            @Html.Raw(_time + "; ")
                        }
                        <h4>Times with sorted: </h4>
                        foreach (var _time in Model.Content.GetTimes().ToList().SortAscending())
                        {
                            @Html.Raw(_time.ToString("dd/MM/yyyy", new CultureInfo("en-GB")) + "; ") <br />
                        }
                }
            </div>
        </div>
