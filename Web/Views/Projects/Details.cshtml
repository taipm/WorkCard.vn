@using Web.Models
@using CafeT.Objects
@model Web.Models.Project

@{
    ViewBag.Title = "Details";
}

<script>
    $(document).ready(function () {
        $("#Content").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/Projects/AutoCompleted",
                    type: "POST",
                    dataType: "json",
                    data: {projectId: '@Model.Id.ToString()', Prefix: request.term },
                    //data: { Prefix: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var _content = $("#Content").val();
                            var _index = _content.lastIndexOf(" ");
                            _content = _content.substring(0, _index + 1);
                            return {
                                label: item,
                                value: _content +  item
                            };
                        }))
                    }
                })
            },
            messages: {
                noResults: "", results: ""
            }
        });
    })
</script>

<div class="row">
    <div class="col-sm-8">
        <div class="bg-picture card-box">
            <div class="profile-info-name">
                <img src="assets/images/profile.jpg"
                     class="img-thumbnail" alt="profile-image">
                <div class="profile-info-detail">
                    <h3 class="m-t-0 m-b-0">@Html.Raw(Model.Title)</h3>
                    <p class="text-muted m-b-20"><i>Web Designer</i></p>
                    <p>
                        @Html.Raw(Model.Description)
                    </p>
                    <div class="button-list m-t-20">
                        <button type="button" class="btn btn-facebook btn-sm waves-effect waves-light">
                            <i class="fa fa-facebook"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-twitter waves-effect waves-light">
                            <i class="fa fa-twitter"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-linkedin waves-effect waves-light">
                            <i class="fa fa-linkedin"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-dribbble waves-effect waves-light">
                            <i class="fa fa-dribbble"></i>
                        </button>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
        <!--/ meta -->
        <div class="row">
            @*@Html.Partial("_CreateIssueForProject", new WorkIssue() { ProjectId = Model.Id })*@
            @using (Ajax.BeginForm("AddContact", "Projects", new { projectId = Model.Id },
                new AjaxOptions { HttpMethod = "POST", UpdateTargetId = Model.Id.ToString() }, null))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(model => Model.Id)
                <div class="card-box">
                    <span class="input-icon icon-right">
                        Hỏi: <br />
                    </span>
                    <textarea id="Content" name="Content" rows="1" class="form-control" placeholder="Post a new message"></textarea>
                    <div class="p-t-10 pull-right">
                        <p>
                            <input type="submit" value="Post" class="btn btn-default" />
                        </p>
                    </div>
                    <ul class="nav nav-pills profile-pills m-t-10">
                        <li>
                            <a href="#"><i class="fa fa-user"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-location-arrow"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class=" fa fa-camera"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-smile-o"></i></a>
                        </li>
                    </ul>
                </div>
            }

            <div id="@Model.Id.ToString()" class="card-box panel panel-border panel-success"></div>
            @Html.Partial("_Issues", Model.Issues)
        </div>
        
    </div>
    <div class="col-sm-4">
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            @if (Model.Contacts != null)
            {
                @Html.Partial("_ContactsInProject", Model.Contacts)
            }
            @if (Model.GetLinks() != null)
            {
                <h4 class="header-title m-t-0 m-b-30"><i class="zmdi zmdi-notifications-none m-r-5"></i> Links</h4>
                <ul class="list-group m-b-0 user-list">
                    @foreach (string url in Model.GetLinks())
                    {
                        <li class="list-group-item">
                            @Html.Partial("_Link", url)
                        </li>
                    }
                </ul>
            }
        </div>
        <div class="card-box">
            <div class="dropdown pull-right">
                <a href="#" class="dropdown-toggle card-drop" data-toggle="dropdown" aria-expanded="false">
                    <i class="zmdi zmdi-more-vert"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                </ul>
            </div>
            <h4 class="header-title m-t-0 m-b-30"><i class="zmdi zmdi-notifications-none m-r-5"></i> My Reminders</h4>
            <ul class="list-group m-b-0 user-list">
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-primary"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Meet Manager</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-success"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Project Discussion</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-muted"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Project Discussion</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="user-list-item">
                        <div class="avatar text-center">
                            <i class="zmdi zmdi-circle text-danger"></i>
                        </div>
                        <div class="user-desc">
                            <span class="name">Meet Manager</span>
                            <span class="desc">February 29, 2016 - 10:30am to 12:45pm</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- end row -->

